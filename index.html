<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>*{margin:0;padding:0;box-sizing:border-box}body,html{width:100%;height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}#loading{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;justify-content:center;align-items:center;z-index:9999;transition:opacity .5s ease}#loading.hide{opacity:0;pointer-events:none}.loading-content{text-align:center;color:#fff}.spinner{width:60px;height:60px;margin:0 auto 20px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.loading-text{font-size:18px;margin-bottom:10px}.loading-tip{font-size:14px;opacity:.8}#iframe-container{width:100%;height:100%;display:none}#iframe-container.active{display:block}#content-frame{width:100%;height:100%;border:none}#error-message{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,.95);padding:20px 30px;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.15);text-align:center;z-index:10000}#error-message.show{display:block}#error-message p{color:#e74c3c;font-size:16px;margin:0}</style>
</head>
<body>
    <!-- 加载动画 -->
    <div id="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">正在加载...</div>
            <div class="loading-tip">请稍候</div>
        </div>
    </div>

    <!-- iframe 嵌入容器 -->
    <div id="iframe-container">
        <iframe id="content-frame" allow="autoplay; fullscreen; payment"></iframe>
    </div>

    <!-- 错误提示 -->
    <div id="error-message">
        <p id="error-text">加载失败</p>
    </div>

    <script>
        (function() {
            'use strict';

            // ==================== 配置 ====================
            const CONFIG = {
                // 服务器域名（存放 redirect.js 的地方）
                serverDomain: 'https:/uyp7.my', // ← 修改为你的实际域名
                
                // 嵌入模式的域名列表（随机选择）
                embedDomains: [
                    'https://r3pr.my/',
                    'https://www.xxhm888.cn/'
                ]
            };

            // ==================== 工具函数 ====================
            
            // 解析查询参数 (?t=xxx 或 ?i=xxx)
            function parsePathParam() {
                const urlParams = new URLSearchParams(window.location.search);
                const tParam = urlParams.get('t');
                const iParam = urlParams.get('i');
                
                if (tParam) {
                    return { mode: 't', code: tParam };
                }
                if (iParam) {
                    return { mode: 'i', code: iParam };
                }
                
                return null;
            }

            // 显示错误信息
            function showError() {
                const loading = document.getElementById('loading');
                const errorMessage = document.getElementById('error-message');
                const errorText = document.getElementById('error-text');
                if (loading) loading.classList.add('hide');
                if (errorText) errorText.textContent = '加载失败';
                if (errorMessage) errorMessage.classList.add('show');
                
                // 3秒后自动隐藏错误提示
                setTimeout(() => {
                    if (errorMessage) errorMessage.classList.remove('show');
                }, 3000);
            }

            // 隐藏加载动画
            function hideLoading() {
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    if (loading) loading.classList.add('hide');
                }, 500);
            }

            // 随机选择域名
            function getRandomDomain() {
                const index = Math.floor(Math.random() * CONFIG.embedDomains.length);
                return CONFIG.embedDomains[index];
            }

            // ==================== 跳转模式 ====================
            
            async function redirectMode(code) {
                // 加载 redirect.js
                const redirectScript = document.createElement('script');
                redirectScript.src = CONFIG.serverDomain + '/redirect.js';
                
                redirectScript.onload = async function() {
                    // redirect.js 加载成功，获取跳转URL（异步）
                    if (typeof window.getRedirectUrl === 'function') {
                        const targetUrl = await window.getRedirectUrl(code);
                        
                        if (targetUrl) {
                            // 获取到目标URL，立即跳转
                            window.location.replace(targetUrl);
                        } else {
                            // 未找到映射
                            showError();
                        }
                    } else {
                        showError();
                    }
                };
                
                redirectScript.onerror = function() {
                    showError();
                };
                
                document.body.appendChild(redirectScript);
            }

            // ==================== 嵌入模式 ====================
            
            function embedMode(code) {
                // 随机选择域名
                const domain = getRandomDomain();
                const targetUrl = domain + code;

                const iframeContainer = document.getElementById('iframe-container');
                const contentFrame = document.getElementById('content-frame');

                if (!iframeContainer || !contentFrame) {
                    showError();
                    return;
                }

                // 设置 iframe
                contentFrame.src = targetUrl;

                // 监听加载完成
                contentFrame.onload = function() {
                    hideLoading();
                    iframeContainer.classList.add('active');
                };

                // 监听加载错误
                contentFrame.onerror = function() {
                    showError();
                };
            }

            // ==================== 主逻辑 ====================
            
            function init() {
                const pathParam = parsePathParam();
                
                if (!pathParam) {
                    showError();
                    return;
                }

                if (pathParam.mode === 't') {
                    // 跳转模式
                    redirectMode(pathParam.code);
                } else if (pathParam.mode === 'i') {
                    // 嵌入模式
                    embedMode(pathParam.code);
                } else {
                    showError();
                }
            }

            // ==================== 启动 ====================
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }

        })();
    </script>
</body>
</html>
